{
    "Solution" : {
        "Id" : "{{cookiecutter.solution_id}}",
        "Name" : "{{cookiecutter.solution_name}}"
    },
    "Tiers" : {
        "elb" : {
            "Components" : {
                "alm" : {
                    "DeploymentUnits" : ["alm-elb"],
                    "MultiAZ" : {{cookiecutter.multi_az}},
                    "LB" : {
                        "Engine" : "classic",
                        "IdleTimeout" : 1200,
                        "Logs" : true,
                        "PortMappings" : {
                            "jenkinshttps" : {}, 
                            "jenkinsjnlp" : {}, 
                            "httpredirect" : {}
                        },
                        "HealthCheckPort" : "jenkins",
                        "IPAddressGroups" : ["automation_users"],
                        "Certificate" : {
                            "IncludeInHost" : {
                                "Product" : true,
                                "Environment" : false,
                                "Segment" : false,
                                "Tier" : false,
                                "Component" : false,
                                "Instance" : false,
                                "Version" : false,
                                "Host" : false
                            }
                        }
                    }
                }
            }
        },
        "app" : {
            "Components" : {
                "alm-ecs" : {
                    "Title" : "Application life cycle management tasks",
                    "DeploymentUnits" : ["alm-ecs"],
                    "Role" : "ECS",
                    "MultiAZ" : {{cookiecutter.multi_az}},
                    "ECS" : {
                        "Services" : {
                            "jenkins" : {
                                "DeploymentUnits" : ["jenkins"],
                                "Containers" : {
                                    "jenkins" : {
                                        "Cpu" : 512,
                                        "Memory" : 2048,
                                        "Ports" : {
                                            "jenkinsjnlp" : {
                                                "LB" : {
                                                    "Tier": "elb",
                                                    "Component"  : "alm",
                                                    "PortMapping" : "jenkinsjnlp"
                                                },
                                                "DynamicHostPort" : false
                                            },
                                            "jenkins" : {
                                                "LB" : {
                                                    "Tier": "elb",
                                                    "Component"  : "alm",
                                                    "PortMapping" : "jenkinshttps",
                                                    "LinkName" : "JENKINSLB"
                                                },
                                                "DynamicHostPort" : false
                                            }
                                        },
                                        "Links" : {
                                            "slave-codeontap" : {
                                                "Tier" : "app",
                                                "Component" : "alm-ecs",
                                                "Task" : "codeontap",
                                                "Role" : "deploy"
                                            }
                                        }
                                    }
                                }
                            },
                            "redirector" : {
                                "DeploymentUnits" : ["redirector"],
                                "Containers" : {
                                    "redirector" : {
                                        "Cpu" : 24,
                                        "Memory" : 64,
                                        "Ports" : {
                                            "http" : {
                                                "LB" : {
                                                    "Tier": "elb",
                                                    "Component"  : "alm",
                                                    "PortMapping" : "httpredirect"
                                                },
                                                "DynamicHostPort" : false
                                            }
                                        }
                                    }
                                }   
                            }      
                        },
                        "Tasks" : {
                            "codeontap" : {
                                "DeploymentUnits" : ["codeontap"],
                                "FixedName" : true,
                                "Containers" : {
                                    "codeontap" : {
                                        "Version" : "latest",
                                        "Cpu" : 512,
                                        "Memory" : 512,
                                        "MaximumMemory" : -1,
                                        "RunCapabilities" : ["NET_ADMIN"],
                                        "Privileged" : true
                                    }
                                }
                            }
                        },
                        "Links" : {
                            "jenkins_home" : {
                                "Tier" : "app",
                                "Component" : "alm-efs",
                                "Mount" : "jenkins"
                            },
                            "codeontap" : {
                                "Tier" : "app",
                                "Component" : "alm-efs",
                                "Mount" : "codeontap"
                            },
                            "awsprofile" : {
                                "Tier" : "app",
                                "Component" : "alm-efs",
                                "Mount" : "awsprofile"
                            }
                        }
                    }
                },
                "alm-efs" : {
                    "DeploymentUnits" : ["alm-efs"],
                    "EFS" : {
                        "Mounts" : {
                            "jenkins" : {
                                "Directory" : "/jenkins_home/"
                            },
                            "codeontap" : {
                                "Directory" : "/codeontap/"
                            },
                            "awsprofile" : {
                                "Directory" : "/awsprofile/"
                            }
                        }
                    }
                }
            }
        }
    },
    "Segment": {
        "SSH": {
            "Enabled" : true,
            "Active" : true,
            "IPAddressGroups" : ["automation_users"]
        }
    },
    "IPAddressGroups" : {
        "automation_users" : {
            "automation_users" : {
                "Description" : "Automation User IP Address List",
                "CIDR": "{{cookiecutter.source_ip_network}}"
            }
        }
    },
    "Processors" : {
        "default" : {
            "ECS": {
                "Processor": "{{cookiecutter.ecs_instance_type}}",
                "MinPerZone": 1,
                "MaxPerZone": 1,
                "DesiredPerZone": 1
            }
        }
    },
    "Ports" :  {
        "httpredirect" : {
            "Port" : 80,
            "Protocol" : "HTTP",
            "IPProtocol" : "tcp",
            "HealthCheck" : {
                "Path" : "/",
                "HealthyThreshold" : "2",
                "UnhealthyThreshold" : "3",
                "Interval" : "30",
                "Timeout" : "5",
                "SuccessCodes" : "301"
            }
        },
        "jenkins" : {
            "Port": 8080,
            "Protocol": "HTTP",
            "IPProtocol": "tcp",
            "HealthCheck" : {
                "Path" : "/robots.txt",
                "Interval" : "30",
                "Timeout" : "29",
                "HealthyThreshold" : "2",
                "UnhealthyThreshold" : "10"
            }
        },
        "jenkinsjnlp" : {
            "Port" : 50000,
            "Protocol" : "TCP",
            "IPProtocol" : "tcp",
            "HealthCheck" : {
                "Interval" : "30",
                "Timeout" : "29",
                "HealthyThreshold" : "2",
                "UnhealthyThreshold" : "10"
            }
        }
    },
    "PortMappings" : { 
        "jenkinshttps": {
            "Source": "https",
            "Destination": "jenkins"
        },
        "jenkinsjnlp" : {
            "Source" : "jenkinsjnlp",
            "Destination" : "jenkinsjnlp"
        },
        "httpredirect" : {
            "Source" : "http",
            "Destination" : "httpredirect"
        }
    }
}
